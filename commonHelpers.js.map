{"version":3,"file":"commonHelpers.js","sources":["../src/js/orderCart.js","../src/js/cart.js"],"sourcesContent":["import { load, save, remove } from './storage';\nimport { common } from './common';\nimport { createOrder } from './api_service';\nimport { renderCart, onClose } from './cart';\nimport { openModalFooter } from './modal';\nimport { succesOrder } from './helpers/modalMarkups';\n\nconst orderCart = load(common.LOCAL_CART_KEY) ?? [];\norderCart.forEach(product => {\n  product.amount = 1;\n});\nsave(common.ORDER, orderCart);\nconsole.log(orderCart);\n\n// Функція для обробки замовлення\nasync function handleOrder() {\n  // Збір інформації з форми\n  const userEmail = document.getElementById('user-email').value;\n\n  // Завантаження або створення кошика\n  const orderCart = load(common.LOCAL_CART_KEY) ?? [];\n\n  // Встановлення кількості для кожного продукту\n  orderCart.forEach(product => {\n    product.amount = 1;\n  });\n\n  // Збереження зміненого кошика\n  save(common.ORDER, orderCart);\n  console.log(orderCart);\n\n  // Перетворення структури даних для відповідності вимогам сервера\n  const formattedOrderCart = orderCart.map(product => {\n    return {\n      productId: product._id,\n      amount: product.amount,\n    };\n  });\n\n  try {\n    // Виклик функції createOrder з оновленими даними з orderCart\n    const orderResponse = await createOrder(userEmail, formattedOrderCart);\n    console.log('Відповідь на замовлення:', orderResponse);\n    console.log(userEmail, formattedOrderCart);\n\n    const markup = succesOrder(orderCart);\n\n    openModalFooter(orderBtn, markup);\n\n    // Чекаємо, наприклад, 5 секунд перед очищенням сторінки\n\n    setTimeout(() => {\n      // Очистка сховища для cart і order\n      save(common.LOCAL_CART_KEY, []);\n      save(common.ORDER, []);\n\n      // Перезавантаження сторінки\n      location.reload();\n    }, 5000);\n\n    console.log('Відповідь на замовлення:', orderResponse);\n    // Очистити форму або виконати інші дії після успішного замовлення\n  } catch (error) {\n    // Обробка помилки\n    console.error('Помилка при замовленні:', error);\n  }\n}\n\nconst checkoutButton = document.getElementById('checkoutButton');\n\n// Обробник події для кнопки\nconst orderBtn = document.getElementById('checkoutButton');\n\norderBtn.addEventListener('click', function (event) {\n  event.preventDefault();\n\n  // Виклик функції для обробки замовлення\n  handleOrder();\n});\n\nexport { orderCart };\n","import { load, save, remove } from './storage';\nimport { common } from './common';\nimport { producCartMarkup } from './markupFunctions';\nimport { orderCart } from './orderCart';\nimport { refs } from './refs';\nimport empty_basket from '../img/yellow_shopping_basket.png';\n\nconst cart = load(common.LOCAL_CART_KEY) ?? [];\n\nconst orderContainer = document.querySelector('.order-container');\n\nconst renderItemCount = () => {\n  const itemCount = cart.length;\n\n  refs.productsCount.textContent = `(${itemCount})`;\n  refs.productsCountHeader.textContent = `(${itemCount})`;\n};\n\nconst validClose = productId => {\n  const index = cart.findIndex(({ _id }) => _id === productId);\n\n  cart.splice(index, 1);\n  remove(common.LOCAL_CART_KEY);\n  save(common.LOCAL_CART_KEY, cart);\n\n  refs.cartList.innerHTML = producCartMarkup(cart);\n  renderTotalAmount(); // Оновлення суми при видаленні товару\n  renderItemCount();\n};\n\nconst onClose = evt => {\n  const closeButton = evt.target.closest('.js-close');\n  if (!closeButton) {\n    return;\n  }\n\n  const id = evt.target.closest('.js-card').dataset.id;\n  console.log(evt.target);\n\n  if (evt.target.classList.contains('js-close')) {\n    validClose(id);\n    orderContainer.innerHTML = '';\n    refs.deleteAllButton.innerHTML = '';\n  }\n};\n\nconst renderTotalAmount = () => {\n  const totalAmount = cart\n    .reduce((acc, product) => acc + product.price, 0)\n    .toFixed(2);\n  refs.totalAmountDisplay.textContent = `$${totalAmount}`;\n};\n\n// Функція для очищення значення ключа \"cart\" у локальному сховищі\nconst clearCartLocalStorage = () => {\n  localStorage.setItem('cart', '[]');\n  location.reload();\n};\n\nconst notFound = () => {\n  refs.cartList.innerHTML = `<li><img class=\"basket-img\" src=\"${empty_basket}\" alt=\"Yellow empty basket\">\n  <div class=\"basket-text\">\n      <p class=\"empty-text\"> Your basket is <span>empty...</span></p>\n      <p class=\"empty-comment\">Go to the main page to select your favorite products and add them to the cart.</p>\n  </div></li>`;\n  orderContainer.innerHTML = '';\n  refs.deleteAllButton.innerHTML = '';\n};\n\nconst renderCart = () => {\n  if (cart.length > 3) {\n    // Застосування вертикального скролу\n    refs.cartList.classList.add('scrollable');\n  }\n\n  if (!cart.length) {\n    notFound();\n    return;\n  }\n\n  refs.cartList.innerHTML = producCartMarkup(cart);\n  refs.cartList.addEventListener('click', onClose);\n  renderTotalAmount();\n};\nrenderItemCount();\nrenderCart();\n\n// Отримуємо всі елементи з класом .counter-pr\nconst counters = document.querySelectorAll('.counter-pr');\n\n// Додаємо обробник подій до кожного елемента\ncounters.forEach(counter => {\n  const counterValue = counter.querySelector('#value');\n  let value = 0; // Початкове значення лічильника\n\n  const decrementButton = counter.querySelector('[data-action=\"decrement\"]');\n  const incrementButton = counter.querySelector('[data-action=\"increment\"]');\n\n  decrementButton.addEventListener('click', () => {\n    if (value > 0) {\n      value -= 1; // Зменшення значення на 1 при кліку на кнопку \"-\", якщо воно більше 0\n      updateCounter(counterValue, value);\n    }\n  });\n\n  incrementButton.addEventListener('click', () => {\n    value += 1; // Збільшення значення на 1 при кліку на кнопку \"+\"\n    updateCounter(counterValue, value);\n  });\n});\n\nconst updateCounter = (counterValue, value) => {\n  counterValue.textContent = value; // Оновлення значення лічильника в інтерфейсі\n};\n\n\n// Додавання обробника подій для кнопки \"Delete all\"\nrefs.deleteAllButton.addEventListener('click', clearCartLocalStorage);\n\nexport { clearCartLocalStorage, renderCart, onClose };\n"],"names":["orderCart","load","common","product","save","handleOrder","userEmail","formattedOrderCart","orderResponse","createOrder","markup","succesOrder","openModalFooter","orderBtn","error","event","cart","orderContainer","renderItemCount","itemCount","refs","validClose","productId","index","_id","remove","producCartMarkup","renderTotalAmount","onClose","evt","id","totalAmount","acc","clearCartLocalStorage","notFound","empty_basket","renderCart","counters","counter","counterValue","value","decrementButton","incrementButton","updateCounter"],"mappings":"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"}