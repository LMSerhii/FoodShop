{"version":3,"file":"commonHelpers.js","sources":["../src/img/yellow_shopping_basket.png","../src/js/cart_2.js"],"sourcesContent":["export default \"__VITE_ASSET__d35d7aca__\"","import * as EmailValidator from 'email-validator';\nimport iziToast from 'izitoast';\nimport '../../node_modules/izitoast/dist/css/iziToast.min.css';\nimport { load, save, remove } from './storage';\nimport { common } from './common';\nimport emty_cart from '../img/yellow_shopping_basket.png';\nimport { createOrder } from './api_service';\nimport svg_sprite from '../img/sprite.svg';\nimport { onEmailEnter } from './footer';\nimport { headerCount } from './header';\n\nconst refs = {\n  cartList: document.querySelector('.cart-list'),\n  deleteAll: document.querySelector('.cart-delete-all'),\n  orderBox: document.querySelector('.order-box'),\n  orderForm: document.querySelector('.order-form'),\n  totalSum: document.querySelector('.order-box-total-price-var'),\n  footerForm: document.querySelector('.subscribe-form'),\n  headerCount: document.querySelector('#product-count-header'),\n  cartWrapper: document.querySelector('.cart-wrapper'),\n};\n\nconst createCartListMarkup = arrey => {\n  if (!arrey.length) {\n    return `<div class=\"emty-cart\">\n                    <img src=\"${emty_cart}\" alt=\"Emty Cart\" class=\"emty-cart-img\" width=\"132\" height=\"114\" />\n                    <p class=\"emty-cart-title\">\n                        Your basket is <span class=\"accent\">empty...</span>\n                    </p>\n                    <p class=\"emty-cart-text\">\n                        Go to the main page to select your favorite products and add them to the\n                        cart.\n                    </p>\n            </div>`;\n  }\n\n  return arrey\n    .map(({ _id, img, name, category, size, price }) => {\n      return `<li class=\"cart-item js-card\" data-id=\"${_id}\">\n\n                  <button class=\"cart-product-delete js-product-cart-delete\">\n                      <svg class=\"cart-product-delete-icon\" width=\"18\" height=\"18\">\n                          <use href=\"${svg_sprite}#close\"></use>\n                      </svg>\n                    </button>\n                    \n                <div class=\"cart-product-container\">\n                    <div class=\"cart-product-img-box\">\n                        <img src=\"${img}\" alt=\"${name}\" class=\"cart-img\" width=\"64\" height=\"64\" />\n                      </div>             \n                <div class=\"cart-content\">\n                    <p class=\"cart-content-title\">${name}</p>                    \n\n                    <ul class=\"cart-content-list\">\n                        <li class=\"cart-content-item\">\n                        Category:\n                        <span class=\"cart-content-item-var\">${category.replace(\n                          '_',\n                          ' '\n                        )}</span>\n                        </li>\n                        <li class=\"cart-content-item\">Size:\n                        <span class=\"cart-content-item-var\">${size}</span>\n                        </li>\n                    </ul>                    \n                    <div class=\"cart-content-bottom\">   \n                        <p class=\"cart-content-price\">$${price}</p>\n                        \n                        \n\n                      <div class=\"cart-content-bottom-addition\">\n                        <button class=\"cart-content-bottom\" type=\"button\" aria-label=\"subtraction\">\n                          <svg class=\"minus-icon\" width=\"18\" height=\"18\" aria-label=\"minus\">\n                            <use class=\"cart-minus-svg\" href=\"${svg_sprite}#minus\"></use>\n                          </svg>\n                        </button>\n\n                        <span class=\"quantity\">1</span>\n\n                        <button class=\"cart-content-bottom\" type=\"button\" aria-label=\"addition\">\n                          <svg class=\"plus-icon\" width=\"18\" height=\"18\" aria-label=\"plus\">\n                            <use class=\"cart-plus-svg\" href=\"${svg_sprite}#plus\"></use>\n                          </svg>\n                        </button>\n                      </div>       \n                    </div>\n                       \n                </li>`;\n    })\n    .join(' ');\n};\n\nconst totalAmount = () => {\n  const currCart = load(common.LOCAL_CART_KEY) ?? [];\n\n  if (!currCart.length) {\n    return;\n  }\n\n  const count = 1;\n\n  return currCart\n    .reduce((acc, product) => acc + product.price * count, 0)\n    .toFixed(2);\n};\n\nconst renderCartList = () => {\n  const currentCartList = load(common.LOCAL_CART_KEY) ?? [];\n\n  if (!currentCartList.length) {\n    refs.deleteAll.style.display = 'none';\n    refs.orderBox.style.display = 'none';\n    const markup = createCartListMarkup(currentCartList);\n    // refs.cartList.innerHTML = markup;\n    refs.cartWrapper.innerHTML = markup;\n    return;\n  }\n\n  refs.deleteAll.style.display = 'flex';\n  refs.orderBox.style.display = 'block';\n\n  const markup = createCartListMarkup(currentCartList);\n  const total = totalAmount();\n  refs.cartList.innerHTML = markup;\n  refs.totalSum.innerHTML = `$${total}`;\n};\n\nconst cartCount = () => {\n  const cartCounter = document.querySelector('#product-count-cart');\n  const currValue = load(common.LOCAL_CART_KEY) ?? [];\n  cartCounter.innerHTML = `(${currValue.length})`;\n};\n\nconst onDeleteAll = () => {\n  save(common.LOCAL_CART_KEY, []);\n  headerCount();\n  cartCount();\n  renderCartList();\n};\n\nconst onCartListClick = evt => {\n  if (evt.currentTarget === evt.target) {\n    return;\n  }\n\n  if (evt.target.closest('.js-product-cart-delete')) {\n    const { id } = evt.target.closest('.js-card').dataset;\n\n    const currentCart = load(common.LOCAL_CART_KEY) ?? [];\n\n    const index = currentCart.findIndex(({ _id }) => _id === id);\n\n    currentCart.splice(index, 1);\n\n    remove(common.LOCAL_CART_KEY);\n\n    save(common.LOCAL_CART_KEY, currentCart);\n\n    headerCount();\n    console.log(refs.headerCount);\n\n    cartCount();\n    renderCartList();\n  }\n};\n\nconst onOrderForm = evt => {\n  evt.preventDefault();\n  const email = document.querySelector('.order-box-input').value;\n\n  if (!EmailValidator.validate(email)) {\n    iziToast.warning({\n      title: 'Caution',\n      message: 'Check your email address',\n    });\n    return;\n  }\n\n  const currCart = load(common.LOCAL_CART_KEY) ?? [];\n\n  let orderList = [];\n\n  currCart.map(element => {\n    orderList.push({\n      productId: element._id,\n      amount: 1,\n    });\n  });\n\n  const data = JSON.stringify({\n    email: email,\n    products: orderList,\n  });\n\n  evt.target.reset();\n  createOrder(data);\n};\n\nconst orderInput = document.getElementById('orderInput');\nconst orderPlaceholderVar = document.querySelector('.order-placeholder-var');\n\n\nconst handleInput = () => {\n  \n  if (orderInput.value.trim() !== '') {\n    orderPlaceholderVar.style.display = 'none';\n  } else {\n    orderPlaceholderVar.style.display = 'inline';\n  }\n};\n\n\nconst handleFocus = () => {\n  orderPlaceholderVar.style.display = 'none';\n};\n\n\norderInput.addEventListener('input', handleInput);\n\norderInput.addEventListener('focus', handleFocus);\n\nrefs.orderForm.addEventListener('submit', onOrderForm);\n\nrefs.cartList.addEventListener('click', onCartListClick);\n\nrefs.deleteAll.addEventListener('click', onDeleteAll);\n\nrefs.footerForm.addEventListener('submit', onEmailEnter);\n\nheaderCount();\ncartCount();\nrenderCartList();\n"],"names":["empty_basket","refs","createCartListMarkup","arrey","_id","img","name","category","size","price","svg_sprite","emty_cart","totalAmount","currCart","load","common","count","acc","product","renderCartList","currentCartList","markup","total","cartCount","cartCounter","currValue","onDeleteAll","save","headerCount","onCartListClick","evt","id","currentCart","index","remove","onOrderForm","email","EmailValidator.validate","iziToast","orderList","element","data","createOrder","orderInput","orderPlaceholderVar","handleInput","handleFocus","onEmailEnter"],"mappings":"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"}